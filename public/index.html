<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>ME2 SMC</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
		<link rel="stylesheet" href="/cdn/bundle/assets/bundle.1.0.0.css" />
		<style>
		.text-muted{
			color: #aaa;
		}
		</style>
	</head>
	<body>
		<div id="app" class="container">
			<div class="panel panel-default">
				<div class="panel-body" data-bind="with: logic">
					<table class="table table-rounded table-striped setup-table table-condensed">
						<thead>
							<tr>
								<th></th>
								<th>
									<span data-bind="click: function () { $data.all_recruited(!$data.all_recruited()); }">
										<span data-bind="
											css: {
												'glyphicon glyphicon-ok': true,
												'text-muted': !$data.all_recruited()
											}
										" class=""></span>
										Recruited
									</span>
								</th>
								<th>
									<span data-bind="click: function () { $data.all_loyal(!$data.all_loyal()); }">
										<span data-bind="
											css: {
												'glyphicon glyphicon-heart': true,
												'text-muted': !$data.all_loyal()
											}
										" class=""></span>
										Loyal
									</span>
								</th>
								<th>
									<span data-bind="click: function () { $data.all_upgraded(!$data.all_upgraded()); }">
										<span data-bind="
											css: {
												'glyphicon glyphicon-circle-arrow-up': true,
												'text-muted': !$data.all_upgraded()
											}
										" class=""></span>
										Upgraded
									</span>
								</th>
								<th>Approach</th>
								<th>Vents</th>
								<th>Long Walk</th>
								<th>Boss</th>
								<th>Outcome</th>
							</tr>
						</thead>
						<tbody>
						<!-- ko foreach: {data: pool, as: 'teammate'} -->
							<tr data-bind="css: {'text-muted': !is_recruited() }">
								<td>
									<a href="#view-profile" data-bind="click: function () { }">
										<span data-bind="text: teammate.name"></span>
									</a>
								</td>
								<td>
									<!-- ko component: { name: 'observable-toggle', params: {
										observable: teammate.is_recruited,
										icon: "ok",
										supertext: ""
									} } --><!-- /ko -->
								</td>
								<td>
									<span data-bind="if: teammate.is_recruited">
									<!-- ko component: { name: 'observable-toggle', params: {
										observable: teammate.is_loyal,
										icon: "heart",
										supertext: ""
									} } --><!-- /ko -->
									</span>
								</td>
								<td>
									<span data-bind="if: teammate.is_loyal">
									<!-- ko component: { name: 'observable-toggle', params: {
										observable: teammate.is_upgraded,
										icon: "circle-arrow-up",
										supertext: ""
									} } --><!-- /ko -->
									</span>
								</td>
								<td>
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.approach_squadmate_1,
										pool: $root.logic.approach_squadmate_pool_1,
										role: Role.ApproachSquadmate1,
										icon: "user",
										supertext: "1"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.approach_squadmate_2,
										pool: $root.logic.approach_squadmate_pool_2,
										role: Role.ApproachSquadmate2,
										icon: "user",
										supertext: "2"
									} } --><!-- /ko -->
								</td>
								<td>
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.vents_specialist,
										pool: $root.logic.vents_specialist_pool,
										role: Role.VentsSpecialist,
										icon: "star",
										supertext: ""
									} } --><!-- /ko -->
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.vents_fireteam_leader,
										pool: $root.logic.vents_fireteam_leader_pool,
										role: Role.VentsFireteamLeader,
										icon: "fire",
										supertext: ""
									} } --><!-- /ko -->
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.vents_squadmate_1,
										pool: $root.logic.vents_squadmate_pool_1,
										role: Role.VentsSquadmate1,
										icon: "user",
										supertext: "1"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.vents_squadmate_2,
										pool: $root.logic.vents_squadmate_pool_2,
										role: Role.VentsSquadmate2,
										icon: "user",
										supertext: "2"
									} } --><!-- /ko -->
								</td>
								<td>
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.long_walk_specialist,
										pool: $root.logic.long_walk_specialist_pool,
										role: Role.LongWalkSpecialist,
										icon: "star",
										supertext: ""
									} } --><!-- /ko -->
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.long_walk_fireteam_leader,
										pool: $root.logic.long_walk_fireteam_leader_pool,
										role: Role.LongWalkFireteamLeader,
										icon: "fire",
										supertext: ""
									} } --><!-- /ko -->
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.long_walk_escort,
										pool: $root.logic.long_walk_escort_pool,
										role: Role.LongWalkEscort,
										icon: "heart-empty",
										supertext: ""
									} } --><!-- /ko -->
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.long_walk_squadmate_1,
										pool: $root.logic.long_walk_squadmate_pool_1,
										role: Role.LongWalkSquadmate1,
										icon: "user",
										supertext: "1"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.long_walk_squadmate_2,
										pool: $root.logic.long_walk_squadmate_pool_2,
										role: Role.LongWalkSquadmate2,
										icon: "user",
										supertext: "2"
									} } --><!-- /ko -->
								</td>
								<td>
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.boss_squadmate_1,
										pool: $root.logic.boss_squadmate_pool_1,
										role: Role.BossSquadmate1,
										icon: "user",
										supertext: "1"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'role-toggle', params: {
										teammate: teammate,
										observable: $root.logic.boss_squadmate_2,
										pool: $root.logic.boss_squadmate_pool_2,
										role: Role.BossSquadmate2,
										icon: "user",
										supertext: "2"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'role-static', params: {
										teammate: teammate,
										role: Role.BossHoldingTheLine,
										supertext: "",
										icon: "flash"
									} } --><!-- /ko -->
								</td>
								<td>
									<span data-bind="
							            if: teammate.survives
							            ">
							            <span class="glyphicon glyphicon-ok-circle text-success"></span>
							        </span>
									<!-- ko component: { name: 'death-role-static', params: {
										teammate: teammate,
										role: Role.ApproachShieldsDeath,
										supertext: "Shield"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'death-role-static', params: {
										teammate: teammate,
										role: Role.ApproachArmorDeath,
										supertext: "Armour"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'death-role-static', params: {
										teammate: teammate,
										role: Role.ApproachWeaponDeath,
										supertext: "Weapon"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'death-role-static', params: {
										teammate: teammate,
										role: Role.VentsDeath,
										supertext: "Vents"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'death-role-static', params: {
										teammate: teammate,
										role: Role.LongWalkSquadmateDeath,
										supertext: "LW Squadmate"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'death-role-static', params: {
										teammate: teammate,
										role: Role.LongWalkFireteamLeaderDeath,
										supertext: "LW Leader"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'death-role-static', params: {
										teammate: teammate,
										role: Role.LongWalkEscortDeath,
										supertext: "Escort"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'death-role-static', params: {
										teammate: teammate,
										role: Role.BossSquadmateDeath,
										supertext: "Boss Squadmate"
									} } --><!-- /ko -->
									<!-- ko component: { name: 'death-role-static', params: {
										teammate: teammate,
										role: Role.BossHoldingTheLineDeath,
										supertext: "HTL"
									} } --><!-- /ko -->
								</td>
							</tr>
						<!-- /ko -->
						</tbody>
					</table>
					<div class="row" data-bind="if: boss_survivors()">
						<div class="col-md-4 col-sm-6">
							<div class="form-group">
								<label>Reports on defence</label>
								<!-- ko component: { name: 'teammate-name', params: {
									teammate: summary_defence_reporter
								} } --><!-- /ko -->
							</div>
							<div class="form-group">
								<label>Advocates keeping the base</label>
								<!-- ko component: { name: 'teammate-name', params: {
									teammate: summary_advocates_keeping_base
								} } --><!-- /ko -->
							</div>
							<div class="form-group">
								<label>Advocates destroying the base</label>
								<!-- ko component: { name: 'teammate-name', params: {
									teammate: summary_advocates_destroying_base
								} } --><!-- /ko -->
							</div>
						</div>
						<div class="col-md-4 col-sm-6">
							<div class="form-group">
								<label>Shepard lives</label>
								<p class="form-control-static" data-bind="text: summary_shepard_lives() ? 'Yes' : 'No'"></p>
							</div>
							<div class="form-group">
								<label>Shepard caught by</label>
								<!-- ko component: { name: 'teammate-name', params: {
									teammate: summary_catches_shepard
								} } --><!-- /ko -->
							</div>
						</div>
						<div class="col-md-4 col-sm-12">
							<div class="form-group">
								<label>Hold the line score</label>
								<p class="form-control-static">
									<span data-bind="text: boss_hold_the_line_total"></span> ÷ <span data-bind="text: boss_hold_the_line_candidates().length"></span> = <span data-bind="text: Math.round(boss_hold_the_line_rating() * 1000) / 1000"></span>
								</p>
							</div>
							<div class="form-group">
								<label>Hold the line deaths</label>
								<p class="form-control-static" data-bind="text: boss_hold_the_line_death_count"></p>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<form role="form" class="form-horizontal">
								<div class="input-group">
									<span class="input-group-addon">State</span>
									<input class="form-control" type="text" data-bind="value: serialised" />
									<span class="input-group-btn">
										<button class="btn btn-primary" type="button" data-bind="click: function () { $root.share($data.serialised()) }">Share</button>
									</span>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" tabindex="-2" role="dialog" data-bind="modal: $root.share()">
			<!-- ko with: $root.share() -->
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="modal-title">Share URL</h4>
						</div>
						<div class="modal-body">
							<p>Share current state:</p>
							<form role="form">
								<div class="form-group">
									<input type="text" class="form-control" data-bind="attr: {value: 'http://' + window.location.hostname + window.location.pathname + '?' + $data }" />
								</div>
							</form>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary" data-bind="click: function () { $root.share(undefined); }">Close</button>
						</div>
					</div>
				</div>
			<!-- /ko -->
		</div>

		<div class="modal fade" tabindex="-1" role="dialog" data-bind="modal: $root.henchman()">
			<!-- ko with: $root.henchman() -->
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="modal-title" data-bind="text: name"></h4>
						</div>
						<div class="modal-body">
							<form class="form-horizontal" role="form">
								<div class="form-group">
									<label class="col-sm-6 control-label">Recruitment can be skipped</label>
									<div class="col-sm-6">
										<p class="form-control-static" data-bind="text: Application.renderYesNo(!is_essential)"></p>
									</div>
								</div>
								<fieldset>
									<legend>Attributes</legend>
									<div class="row">
										<div class="col-xs-6">
											<div class="form-group">
												<label class="col-sm-8 control-label">Tech Expert</label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderYesNo(is_tech_expert)"></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label">Biotic Expert</label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderYesNo(is_biotic_expert)"></p>
												</div>
											</div>
										</div>
										<div class="col-xs-6">
											<div class="form-group">
												<label class="col-sm-8 control-label">Fireteam Leader</label>
												<div class="col-sm-4">
													<p class="form-control-static"><span data-bind="text: Application.renderYesNo(is_leader)"></span><span data-bind="visible: is_super_leader"> ✸</span></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label"><abbr title="Hold the line">HTL</abbr> score</label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: htl_value"></p>
												</div>
											</div>
										</div>
									</div>
								</fieldset>
								<fieldset>
									<legend>Eligibility for Roles</legend>
									<div class="row">
										<div class="col-xs-6">
											<div class="form-group">
												<label class="col-sm-8 control-label">Vents</label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderYesNo(is_vent_candidate)"></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label">Biotic Bubble</label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderYesNo(is_bubble_candidate)"></p>
												</div>
											</div>
										</div>
										<div class="col-xs-6">
											<div class="form-group">
												<label class="col-sm-8 control-label">Leader</label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderYesNo(is_leader_candidate)"></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label">Crew Escort</label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderYesNo(is_escort_candidate)"></p>
												</div>
											</div>
										</div>
									</div>
								</fieldset>
								<fieldset>
									<legend>Priority</legend>
									<div class="row">
										<div class="col-xs-6">
											<div class="form-group">
												<label class="col-sm-8 control-label"><a tabindex="0" data-bind="click: Application.showArmourDeathRankPopover">Armour Death</a></label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderRank(getArmourDeathPriorityRank())"></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label"><a tabindex="1" data-bind="click: Application.showShieldingDeathRankPopover">Shielding Death</a></label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderRank(getShieldingDeathPriorityRank())"></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label"><a tabindex="2" data-bind="click: Application.showCannonDeathRankPopover">Cannon Death</a></label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderRank(getCannonDeathPriorityRank())"></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label"><a tabindex="3" data-bind="click: Application.showLongWalkDeathRankPopover">Long Walk Death</a></label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderRank(getLongWalkDeathPriorityRank())"></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label"><a tabindex="4" data-bind="click: Application.showHTMLDeathRankPopover">HTL Death</a></label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderRank(getHTLDeathPriorityRank())"></p>
												</div>
											</div>
										</div>
										<div class="col-xs-6">
											<div class="form-group">
												<label class="col-sm-8 control-label"><a tabindex="5" data-bind="click: Application.showDefenceReportRankPopover">Defence Report</a></label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderRank(getDefenceReportPriorityRank())"></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label"><a tabindex="6" data-bind="click: Application.showKeepBaseAdvocateRankPopover">Keep Base Advocate</a></label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="html: Application.renderRank(getKeepBasePriorityRank())"></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label"><a tabindex="7" data-bind="click: Application.showDestroyBaseAdvocateRankPopover">Destroy Base Advocate</a></label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="html: Application.renderRank(getDestroyBasePriorityRank())"></p>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-8 control-label"><a tabindex="8" data-bind="click: Application.showCutsceneRescueRankPopover">Catch Shepard</a></label>
												<div class="col-sm-4">
													<p class="form-control-static" data-bind="text: Application.renderRank(getCutsceneRescuePriorityRank())"></p>
												</div>
											</div>
										</div>
									</div>
								</fieldset>
							</form>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary" data-bind="click: function () { $root.henchman(undefined); }">Close</button>
						</div>
					</div>
				</div>
			<!-- /ko -->
		</div>

		<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash-compat/3.9.3/lodash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
		<script src="/cdn/bundle/assets/bundle.1.0.0.js"></script>
		<script>
			$(function () {

				// Prepare tooltips
				$("[data-toggle=tooltip]").tooltip();

				var app = new Application();

				// Debugging
				window.app = app;

				// Initialise Knockout
				ko.applyBindings(app);
			});
		</script>
	</body>
</html>
